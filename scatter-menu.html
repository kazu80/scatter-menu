<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="scatter-menu">
    <template>
        <style>
            :host {
                display       : block;

                --menu-size   : 50%;
                --menu-height : 500px;
                --item-size   : 50px;
            }

            .menu {
                position : relative;
                width    : var(--menu-size);
                height   : var(--menu-height);
            }

            .item {
                position      : absolute;
                top           : 0;
                left          : 0;
                width         : var(--item-size);
                height        : var(--item-size);
                border        : 1px solid #000000;
                border-radius : 50%;
                transition    : all 800ms ease;
            }

            /**
             * Column 1
             */
            .item.column01 {
                transition-delay : 0ms;
            }

            .item.column02 {
                transition-delay : 1000ms;
            }

            .item.column03 {
                transition-delay : 2000ms;
            }

            /**
             * column 1
             */
            .item.active01 {
                top  : calc(var(--space-size) * 1);
                left : calc(var(--menu-size) - (var(--item-size) * 1) - (var(--space-size) * 0));
            }

            .item.active02 {
                top  : calc(var(--space-size) * 1);
                left : calc(var(--menu-size) - (var(--item-size) * 2) - (var(--space-size) * 1));
            }

            .item.active03 {
                top  : calc(var(--space-size) * 1);
                left : calc(var(--menu-size) - (var(--item-size) * 3) - (var(--space-size) * 2));
            }

            .item.active04 {
                top  : calc(var(--space-size) * 1);
                left : calc(var(--menu-size) - (var(--item-size) * 4) - (var(--space-size) * 3));
            }

            /**
             * column 2
             */
            .item.active05 {
                top  : calc(var(--item-size) + (var(--space-size) * 1));
                left : calc(var(--menu-size) - (var(--item-size) * 1) - (var(--space-size) * 0));
            }

            .item.active06 {
                top  : calc(var(--item-size) + (var(--space-size) * 1));
                left : calc(var(--menu-size) - (var(--item-size) * 2) - (var(--space-size) * 1));
            }

            .item.active07 {
                top  : calc(var(--item-size) + (var(--space-size) * 1));
                left : calc(var(--menu-size) - (var(--item-size) * 3) - (var(--space-size) * 2));
            }

            .item.active08 {
                top  : calc(var(--item-size) + (var(--space-size) * 1));
                left : calc(var(--menu-size) - (var(--item-size) * 4) - (var(--space-size) * 3));
            }

        </style>

        <div class="menu">
            <slot></slot>
        </div>

    </template>

    <script>
        /**
         * `scatter-menu`
         *
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class ScatterMenu extends Polymer.Element {
            static get is () { return 'scatter-menu'; }

            static get properties () {
                return {
                    isOpen  : {
                        type    : Boolean,
                        value   : false,
                        observer: '_isOpen'
                    },
                    selected: {
                        type  : Number,
                        notify: true,
                    },
                    row     : {},
                    col     : {},
                };
            }

            ready () {
                super.ready ();

                new Polymer.FlattenedNodesObserver (this.shadowRoot.querySelector ('slot'), (info) => {
                    this.menuElements =
                        this.shadowRoot
                            .querySelector ('slot')
                            .assignedNodes ({flatten: true})
                            .filter (n => n.nodeName === 'SCATTER-MENU-ITEM');

                    this._setMenus ((menu, key) => {
                        menu.setAttribute ('scatter-active', 'false');
                        menu.setAttribute ('name', key + 1);

                        const row = (key + 1) % this.row === 0 ? Number (this.row) : (key + 1) % this.row;
                        menu.setAttribute ('row', row);

                        const col = Math.floor (key / (this.col)) + 1;
                        menu.setAttribute ('col', col);

                        // menu close
                        menu.addEventListener ('menuSelected', (e) => {
                            this.selected = e.detail.selected;
                            this.isOpen = false;
                        });
                    });
                });
            }

            _setMenus (cb) {
                for (let i = 0; i < this.menuElements.length; i++) {
                    const menu = this.menuElements[i];

                    if (typeof cb === 'function') {
                        cb (menu, i);
                    }
                }
            }

            _isOpen (val, old) {
                if (old === undefined) {
                    return;
                }

                if (val) {
                    this._active ();
                } else {
                    this._back ();
                }
            }

            _active () {
                this._setMenus ((menu) => {
                    menu.scatterActive = 'true';
                });
            }

            _back () {
                this._setMenus ((menu) => {
                    menu.scatterActive = 'false';
                });
            }
        }

        window.customElements.define (ScatterMenu.is, ScatterMenu);
    </script>
</dom-module>
