<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="scatter-menu-item">
    <template>
        <style>
            :host {
                --menu-order  : 1;
                --menu-column : 0;
                --item-size   : 50px;
                --space-size  : 20px;
            }

            .button-wrapper {
                position   : absolute;
                top        : calc(-1 * var(--item-size));
                left       : calc(-2 * var(--item-size));
                transition : all ease;
            }

            .button-wrapper.active {
                top  : calc(((var(--item-size) * var(--menu-column)) + (var(--space-size) * var(--menu-column))));
                left : calc((var(--item-size) * (var(--menu-order) - 1)) + (var(--space-size) * (var(--menu-order) - 1)));
            }

            button:focus,
            button:active {
                outline : none;
            }

            .item {
                position         : relative;
                padding          : 0;
                width            : var(--item-size);
                height           : var(--item-size);
                border           : 1px solid #000000;
                border-radius    : 50%;
                background-color : #f8c555;
                filter           : brightness(1.0);
                box-sizing       : border-box;
                opacity          : .2;
                transition       : all ease 400ms;
            }

            .col1 {
                transition-delay : 0ms;
            }

            .col2 {
                transition-delay : 150ms;
            }

            .col3 {
                transition-delay : 300ms;
            }

            .row1 {
                transition-duration : 500ms;
            }

            .row2 {
                transition-duration : 600ms;
            }

            .row3 {
                transition-duration : 700ms;
            }

            .item.active {
                opacity : 1;
            }

            .flash {
                animation : flash 200ms ease;
            }

            @keyframes flash {
                0%, 100% {
                    filter : brightness(1.0);
                }
                50% {
                    filter : brightness(1.5);
                }
            }

            .title {
                margin-top : 10px;
                text-align : center;
                font-size  : 20px;
                opacity    : 0;
                transition : opacity 100ms ease-in;
            }

            .title.active {
                opacity : 1;
            }

            .circle01 {
                position      : absolute;
                top           : 50%;
                left          : 50%;
                width         : var(--item-size);
                height        : var(--item-size);
                border        : 1px solid #000000;
                border-radius : 50%;
                transform     : translate(-50%, -50%) scale(1);
                box-sizing    : border-box;
                transition    : transform 400ms ease-in-out;
            }

            .circle01.active {
                transform : translate(-50%, -50%) scale(0.5);
            }

        </style>
        <div id="wrapper" class="button-wrapper">
            <button id="item" class="item">
                <div id="circle01" class="circle01"></div>
            </button>
            <div id="title" class="title">[[menuTitle]]</div>
        </div>
    </template>
    <script>
        /**
         * `scatter-menu-item`
         *
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class ScatterMenuItem extends Polymer.Element {
            static get is () { return 'scatter-menu-item'; }

            static get properties () {
                return {
                    menuOrder    : {
                        type    : Number,
                        observer: '_setOrder'
                    },
                    menuColumn   : {
                        type    : Number,
                        value   : 1,
                        observer: '_setColumn'
                    },
                    menuSpace    : {
                        type    : Number,
                        value   : 20,
                        observer: '_setSpace'
                    },
                    menuTitle    : {},
                    scatterActive: {
                        type    : String,
                        observer: '_active'
                    },
                    row          : {
                        observer: '_row'
                    },
                    col          : {
                        observer: '_col'
                    },
                };
            }

            ready () {
                super.ready ();

                this._setEvent ();
            }

            _row (row, old) {
                this.$.wrapper.classList.add (`row${row}`);
            }

            _col (col, old) {
                this.$.wrapper.classList.add (`col${col}`);
            }

            _setEvent () {
                //
                this.$.wrapper.addEventListener ('transitionend', (event) => {
                    if (event.propertyName === 'left' && this.$.item.classList.contains ('active')) {
                        this.$.title.classList.add ('active');
                    }
                });

                //
                this.$.item.addEventListener ('click', () => {
                    // effect
                    this.$.circle01.classList.add ('active');
                    this.$.circle01.addEventListener ('transitionend', () => {

                        this.$.item.classList.add ('flash');
                        this.$.item.addEventListener ('animationend', () => this.$.item.classList.remove ('flash'));

                        //
                        const id = this.getAttribute ('name');
                        this.dispatchEvent (
                            new CustomEvent ('menuSelected', {bubbles: true, composed: true, detail: {selected: id}}));
                    });
                });
            }

            _setOrder (val, order) {
                this.style.setProperty ('--menu-order', val);
            }

            _setColumn (val, order) {
                this.style.setProperty ('--menu-column', val - 1);
            }

            _setSpace (val, order) {
                this.style.setProperty ('--space-size', `${val}px`);
            }

            _active (val, order) {
                if (order === undefined) {
                    return;
                }
                if (val === 'true') {
                    this.$.wrapper.classList.add ('active');
                    this.$.item.classList.add ('active');

                } else {
                    this.$.wrapper.classList.remove ('active');
                    this.$.item.classList.remove ('active');
                    this.$.title.classList.remove ('active');
                    this.$.circle01.classList.remove ('active');
                }
            }
        }

        window.customElements.define (ScatterMenuItem.is, ScatterMenuItem);
    </script>
</dom-module>
